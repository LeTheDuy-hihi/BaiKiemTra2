@page
@model PickleballClubManagement.Pages.Matches.CreateModel
@{
    ViewData["Title"] = "Ghi Nh·∫≠n Tr·∫≠n ƒê·∫•u";
}

<div class="page-header">
    <h1 class="page-title">üìä Ghi Nh·∫≠n Tr·∫≠n ƒê·∫•u</h1>
</div>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">
        ‚ùå @Model.ErrorMessage
    </div>
}

<div class="card" style="max-width: 900px; margin: 0 auto;">
    <form method="post" id="matchForm" onchange="updatePlayerOptions()">
        <!-- Th·ªÉ Th·ª©c -->
        <div class="form-group">
            <label class="form-label">üéæ Th·ªÉ Th·ª©c</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <label style="cursor: pointer;">
                    <input type="radio" asp-for="Input.Format" value="0" checked onchange="togglePlayerFields()" />
                    <span style="margin-left: 0.5rem; font-weight: 600;">ƒê∆°n (1 vs 1)</span>
                </label>
                <label style="cursor: pointer;">
                    <input type="radio" asp-for="Input.Format" value="1" onchange="togglePlayerFields()" />
                    <span style="margin-left: 0.5rem; font-weight: 600;">ƒê√¥i (2 vs 2)</span>
                </label>
            </div>
        </div>

        <!-- K√®o Li√™n Quan -->
        <div class="form-group">
            <label asp-for="Input.ChallengeId">‚öîÔ∏è K√®o Li√™n Quan (T√πy Ch·ªçn)</label>
            <select class="form-control" asp-for="Input.ChallengeId">
                <option value="">-- Kh√¥ng c√≥ k√®o --</option>
                @foreach (var challenge in Model.OpenChallenges)
                {
                    <option value="@challenge.Id">@challenge.Title (@challenge.Creator?.FullName)</option>
                }
            </select>
        </div>

        <!-- Ng∆∞·ªùi Ch∆°i -->
        <div style="background-color: var(--color-gray-100); padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
            <h3 style="margin-top: 0;">üë• Ch·ªçn Ng∆∞·ªùi Ch∆°i</h3>
            
            <!-- Team 1 (Ng∆∞·ªùi Th·∫Øng) -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="color: #28a745;">‚úÖ ƒê·ªôi Th·∫Øng</h4>
                <div class="form-group">
                    <label asp-for="Input.Winner1Id">Ng∆∞·ªùi Th·∫Øng 1 <span style="color: red;">*</span></label>
                    <select class="form-control" asp-for="Input.Winner1Id" required>
                        <option value="">-- Ch·ªçn Ng∆∞·ªùi --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                    <span asp-validation-for="Input.Winner1Id" class="validation-error"></span>
                </div>

                <div class="form-group" id="winner2Group" style="display: none;">
                    <label asp-for="Input.Winner2Id">Ng∆∞·ªùi Th·∫Øng 2</label>
                    <select class="form-control" asp-for="Input.Winner2Id">
                        <option value="">-- Ch·ªçn Ng∆∞·ªùi --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
            </div>

            <!-- Team 2 (Ng∆∞·ªùi Thua) -->
            <div>
                <h4 style="color: #dc3545;">‚ùå ƒê·ªôi Thua</h4>
                <div class="form-group">
                    <label asp-for="Input.Loser1Id">Ng∆∞·ªùi Thua 1 <span style="color: red;">*</span></label>
                    <select class="form-control" asp-for="Input.Loser1Id" required>
                        <option value="">-- Ch·ªçn Ng∆∞·ªùi --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                    <span asp-validation-for="Input.Loser1Id" class="validation-error"></span>
                </div>

                <div class="form-group" id="loser2Group" style="display: none;">
                    <label asp-for="Input.Loser2Id">Ng∆∞·ªùi Thua 2</label>
                    <select class="form-control" asp-for="Input.Loser2Id">
                        <option value="">-- Ch·ªçn Ng∆∞·ªùi --</option>
                        @foreach (var member in Model.Members)
                        {
                            <option value="@member.Id">@member.FullName (‚≠ê @member.RankLevel.ToString("F1"))</option>
                        }
                    </select>
                </div>
            </div>
        </div>

        <!-- T√≠nh Rank -->
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" asp-for="Input.IsRanked" checked />
                <span>üìà T√≠nh ƒëi·ªÉm Rank</span>
            </label>
            <small style="color: var(--color-gray-700);">N·∫øu t√≠ch, k·∫øt qu·∫£ tr·∫≠n n√†y s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn Rank DUPR c·ªßa t·∫•t c·∫£ ng∆∞·ªùi ch∆°i</small>
        </div>

        <!-- Submit -->
        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary">
                üíæ Ghi Nh·∫≠n Tr·∫≠n ƒê·∫•u
            </button>
            <a href="@Url.Page("History")" class="btn btn-outline">
                ‚Üê Quay L·∫°i
            </a>
        </div>
    </form>
</div>

<script>
function togglePlayerFields() {
    const format = document.querySelector('input[name="Input.Format"]:checked').value;
    const winner2Group = document.getElementById('winner2Group');
    const loser2Group = document.getElementById('loser2Group');
    
    if (format === '1') { // Doubles
        winner2Group.style.display = 'block';
        loser2Group.style.display = 'block';
        document.getElementById('Input_Winner2Id').required = true;
        document.getElementById('Input_Loser2Id').required = true;
    } else { // Singles
        winner2Group.style.display = 'none';
        loser2Group.style.display = 'none';
        document.getElementById('Input_Winner2Id').value = '';
        document.getElementById('Input_Loser2Id').value = '';
        document.getElementById('Input_Winner2Id').required = false;
        document.getElementById('Input_Loser2Id').required = false;
    }
}

function updatePlayerOptions() {
    // Optional: Add logic to prevent selecting same player multiple times
}

// Initialize on page load
window.onload = function() {
    togglePlayerFields();
};
</script>
