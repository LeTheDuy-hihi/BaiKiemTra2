@page
@model PickleballClubManagement.Pages.Financial.CategoriesModel
@{
    ViewData["Title"] = "Qu·∫£n L√Ω Danh M·ª•c Giao D·ªãch";
}

<div class="page-header">
    <h1 class="page-title">üè∑Ô∏è Qu·∫£n L√Ω Danh M·ª•c Giao D·ªãch</h1>
</div>

@if (!string.IsNullOrEmpty(Model.SuccessMessage))
{
    <div class="alert alert-success">
        ‚úÖ @Model.SuccessMessage
    </div>
}

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">
        ‚ùå @Model.ErrorMessage
    </div>
}

<div class="grid" style="grid-template-columns: 1fr 2fr; gap: 2rem;">
    <!-- Form Th√™m/S·ª≠a Danh M·ª•c -->
    <div class="card">
        <div class="card-header">
            <h3 style="margin: 0;">üìù @(Model.EditingCategoryId.HasValue ? "C·∫≠p Nh·∫≠t Danh M·ª•c" : "Th√™m Danh M·ª•c")</h3>
        </div>

        <form method="post" style="padding: 1.5rem;">
            <div class="form-group">
                <label for="name">T√™n Danh M·ª•c <span style="color: red;">*</span></label>
                <input type="text" id="name" name="InputCategory.Name" class="form-control" 
                       placeholder="V√≠ d·ª•: Ti·ªÅn S√¢n, N∆∞·ªõc, Qu·ªπ..." required 
                       value="@Model.InputCategory.Name" />
                <span asp-validation-for="InputCategory.Name" class="validation-error"></span>
            </div>

            <div class="form-group">
                <label for="type">Lo·∫°i <span style="color: red;">*</span></label>
                <select id="type" name="InputCategory.Type" class="form-control" required>
                    <option value="">-- Ch·ªçn Lo·∫°i --</option>
                    <option value="0" asp-selected="@(Model.InputCategory.Type == TransactionType.Income)">üìà Thu (Income)</option>
                    <option value="1" asp-selected="@(Model.InputCategory.Type == TransactionType.Expense)">üìâ Chi (Expense)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="description">M√¥ T·∫£</label>
                <textarea id="description" name="InputCategory.Description" class="form-control" 
                          placeholder="M√¥ t·∫£ chi ti·∫øt danh m·ª•c"
                          style="min-height: 80px;">@Model.InputCategory.Description</textarea>
            </div>

            @if (Model.EditingCategoryId.HasValue)
            {
                <input type="hidden" name="EditingCategoryId" value="@Model.EditingCategoryId" />
                <button type="submit" asp-page-handler="Update" class="btn btn-primary" style="width: 100%;">
                    üíæ C·∫≠p Nh·∫≠t
                </button>
            }
            else
            {
                <button type="submit" asp-page-handler="Create" class="btn btn-primary" style="width: 100%;">
                    ‚ûï Th√™m Danh M·ª•c
                </button>
            }
        </form>
    </div>

    <!-- Danh s√°ch danh m·ª•c -->
    <div>
        @if (Model.Categories.Any())
        {
            <div class="grid" style="grid-template-columns: 1fr;">
                @foreach (var category in Model.Categories.OrderBy(c => c.Type))
                {
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0;">
                                    @(category.Type == TransactionType.Income ? "üìà" : "üìâ") @category.Name
                                </h4>
                                <small style="color: var(--color-gray-700);">
                                    @(category.Type == TransactionType.Income ? "Thu Nh·∫≠p" : "Chi Ph√≠")
                                </small>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-sm btn-outline" 
                                        onclick="editCategory(@category.Id, '@category.Name', @((int)category.Type), '@(category.Description ?? "")')">
                                    ‚úèÔ∏è S·ª≠a
                                </button>
                                <form method="post" asp-page-handler="Delete" asp-route-id="@category.Id" 
                                      style="display: inline;" 
                                      onsubmit="return confirm('X√°c nh·∫≠n x√≥a danh m·ª•c n√†y?');">
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        üóëÔ∏è X√≥a
                                    </button>
                                </form>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(category.Description))
                        {
                            <div style="padding: 1rem 0; color: var(--color-gray-700); font-size: 0.875rem;">
                                üìå @category.Description
                            </div>
                        }
                    </div>
                }
            </div>
        }
        else
        {
            <div class="card" style="text-align: center; padding: 2rem;">
                <div style="font-size: 2rem; margin-bottom: 1rem;">üè∑Ô∏è</div>
                <p>Kh√¥ng c√≥ danh m·ª•c n√†o</p>
            </div>
        }
    </div>
</div>

<script>
function editCategory(id, name, type, description) {
    document.getElementById("name").value = name;
    document.getElementById("type").value = type;
    document.getElementById("description").value = description;
    document.querySelector("input[name='EditingCategoryId']").value = id;
    
    // Scroll to form
    document.querySelector(".card").scrollIntoView({ behavior: "smooth" });
}
</script>
