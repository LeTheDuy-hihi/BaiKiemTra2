@page
@model PickleballClubManagement.Pages.Challenges.IndexModel
@{
    ViewData["Title"] = "SÃ n Äáº¥u KÃ¨o";
}

<div class="page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 class="page-title">âš”ï¸ SÃ n Äáº¥u KÃ¨o</h1>
            <p class="text-muted">TÃ¬m Ä‘á»‘i thá»§ xá»©ng táº§m hoáº·c tham gia giáº£i Ä‘áº¥u!</p>
        </div>
        <a href="/Challenges/Create" class="btn btn-primary btn-lg">
            ğŸ”¥ Táº¡o KÃ¨o Má»›i
        </a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<div class="grid">
    @foreach (var challenge in Model.Challenges)
    {
        var isMiniGame = challenge.Type == PickleballClubManagement.Models.ChallengeType.MiniGame;
        
        <div class="card @(isMiniGame ? "card-minigame" : "")">
            <div class="card-header">
                @if (isMiniGame)
                {
                    <span class="status-badge status-ongoing">ğŸ† Giáº£i Äáº¥u</span>
                }
                else
                {
                    <span class="status-badge status-open">ğŸŸ¢ TÃ¬m Äá»‘i</span>
                }
                <span class="text-muted">@challenge.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
            </div>
            
            <div class="card-body">
                <h3 class="card-title">@challenge.Title</h3>
                
                @if (isMiniGame)
                {
                    <div style="margin-bottom: 1rem; color: #E65100; font-weight: 600;">
                        @(challenge.ResultMode == PickleballClubManagement.Models.GameMode.TeamBattle ? "âš”ï¸ Team Battle" : "ğŸ”„ VÃ²ng TrÃ²n")
                    </div>
                }

                <p class="text-muted" style="margin-bottom: 1.5rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">@challenge.Description</p>
                
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
                    <div class="stat-badge">
                        ğŸ‘¤ @challenge.Creator?.FullName
                    </div>
                    @if (challenge.Creator != null)
                    {
                        <div class="stat-badge">
                            â­ Rank @challenge.Creator.RankLevel.ToString("F1")
                        </div>
                    }
                    
                    @if (isMiniGame)
                    {
                        <div class="stat-badge" style="background: #FFF3E0; color: #E65100;">
                            ğŸ’° ThÆ°á»Ÿng: @challenge.PrizePool.ToString("N0") Ä‘
                        </div>
                        <div class="stat-badge" style="background: #E3F2FD; color: #0D47A1;">
                            ğŸ« VÃ©: @challenge.EntryFee.ToString("N0") Ä‘
                        </div>
                    }
                </div>

                <form method="post" asp-page-handler="Accept" asp-route-id="@challenge.Id">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        @(isMiniGame ? "ğŸ“ ÄÄƒng KÃ½ Tham Gia" : "ğŸ¤ Nháº­n KÃ¨o NÃ y")
                    </button>
                </form>
            </div>
        </div>
    }
</div>

@if (!Model.Challenges.Any())
{
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ¾</div>
        <p class="empty-state-text">ChÆ°a cÃ³ kÃ¨o nÃ o Ä‘ang má»Ÿ. HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn táº¡o kÃ¨o!</p>
        <a href="/Challenges/Create" class="btn btn-primary" style="margin-top: 1rem;">
            ğŸ”¥ Táº¡o KÃ¨o Ngay
        </a>
    </div>
}

<style>
    .card-minigame {
        border: 2px solid #FF9800;
        background: linear-gradient(to bottom right, #fff, #FFF3E0);
    }
    .stat-badge {
        background: var(--color-gray-100);
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.875rem;
        font-weight: 500;
    }
</style>
