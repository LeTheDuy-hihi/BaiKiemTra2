@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@model PickleballClubManagement.Pages.Challenges.ManageModel
@{
    ViewData["Title"] = "Qu·∫£n L√Ω K√®o";
}

<div class="page-header">
    <h1 class="page-title">üìã Qu·∫£n L√Ω K√®o ƒê·∫•u</h1>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<div style="margin-bottom: 2rem;">
    <div style="display: flex; gap: 1rem;">
        <button class="btn @(Model.FilterStatus == null ? "btn-primary" : "btn-secondary")" 
                onclick="window.location.href='/Challenges/Manage'">
            T·∫•t C·∫£ (@Model.AllChallenges.Count)
        </button>
        <button class="btn @(Model.FilterStatus == ChallengeStatus.Open ? "btn-primary" : "btn-secondary")" 
                onclick="window.location.href='/Challenges/Manage?status=0'">
            üîµ ƒêang M·ªü (@Model.AllChallenges.Count(c => c.Status == ChallengeStatus.Open))
        </button>
        <button class="btn @(Model.FilterStatus == ChallengeStatus.Accepted ? "btn-primary" : "btn-secondary")" 
                onclick="window.location.href='/Challenges/Manage?status=1'">
            üü† ƒê√£ Ch·ªët (@Model.AllChallenges.Count(c => c.Status == ChallengeStatus.Accepted))
        </button>
        <button class="btn @(Model.FilterStatus == ChallengeStatus.Completed ? "btn-primary" : "btn-secondary")" 
                onclick="window.location.href='/Challenges/Manage?status=2'">
            üü¢ Ho√†n Th√†nh (@Model.AllChallenges.Count(c => c.Status == ChallengeStatus.Completed))
        </button>
    </div>
</div>

@if (Model.Challenges.Any())
{
    <div class="grid" style="grid-template-columns: 1fr;">
        @foreach (var challenge in Model.Challenges)
        {
            <div class="card">
                <div class="card-header">
                    @if (challenge.Status == ChallengeStatus.Open)
                    {
                        <span class="status-badge status-open">üîµ ƒêang T√¨m ƒê·ªëi</span>
                    }
                    else if (challenge.Status == ChallengeStatus.Accepted)
                    {
                        <span class="status-badge status-accepted">üü† ƒê√£ Ch·ªët K√®o</span>
                    }
                    else
                    {
                        <span class="status-badge status-completed">üü¢ Ho√†n Th√†nh</span>
                    }
                    <span class="text-muted">@challenge.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
                </div>
                
                <div class="card-body">
                    <h3 class="card-title">@challenge.Title</h3>
                    <div style="margin-bottom: 1rem;">
                        <strong>Ng∆∞·ªùi t·∫°o:</strong> @challenge.Creator?.FullName
                        @if (challenge.Creator != null)
                        {
                            <span class="rank-badge">‚≠ê @challenge.Creator.RankLevel.ToString("F1")</span>
                        }
                    </div>
                    <p class="text-muted">@challenge.Description</p>
                </div>
                
                <div class="card-footer">
                    <span style="color: var(--color-gray-600); font-size: 0.875rem;">
                        ID: #@challenge.Id
                    </span>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="empty-state">
        <div class="empty-state-icon">üìã</div>
        <p class="empty-state-text">Kh√¥ng c√≥ k√®o n√†o @(Model.FilterStatus.HasValue ? "·ªü tr·∫°ng th√°i n√†y" : "")</p>
    </div>
}
