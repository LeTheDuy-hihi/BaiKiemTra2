@page
@model PickleballClubManagement.Pages.Bookings.HistoryModel
@{
    ViewData["Title"] = "L·ªãch S·ª≠ ƒê·∫∑t S√¢n";
}

<div class="page-header">
    <h1 class="page-title">üìÖ L·ªãch S·ª≠ ƒê·∫∑t S√¢n ƒê·∫•u</h1>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
    <a href="@Url.Page("History", new { status = "all" })" 
       class="btn @(Model.FilterStatus == "all" ? "btn-primary" : "btn-outline")">
        üìã T·∫•t C·∫£
    </a>
    <a href="@Url.Page("History", new { status = "Confirmed" })" 
       class="btn @(Model.FilterStatus == "Confirmed" ? "btn-primary" : "btn-outline")">
        ‚úÖ ƒê√£ X√°c Nh·∫≠n
    </a>
    <a href="@Url.Page("History", new { status = "Pending" })" 
       class="btn @(Model.FilterStatus == "Pending" ? "btn-primary" : "btn-outline")">
        ‚è≥ Ch·ªù X·ª≠ L√Ω
    </a>
    <a href="@Url.Page("History", new { status = "Cancelled" })" 
       class="btn @(Model.FilterStatus == "Cancelled" ? "btn-primary" : "btn-outline")">
        ‚ùå ƒê√£ H·ªßy
    </a>
</div>

@if (Model.Bookings.Any())
{
    <div class="grid" style="grid-template-columns: 1fr;">
        @foreach (var booking in Model.Bookings)
        {
            <div class="card">
                <div class="card-header">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            @if (booking.Status == BookingStatus.Confirmed)
                            {
                                <span class="status-badge status-completed">‚úÖ ƒê√É X√ÅC NH·∫¨N</span>
                            }
                            else if (booking.Status == BookingStatus.Pending)
                            {
                                <span class="status-badge status-open">‚è≥ CH·ªú X·ª¨ L√ù</span>
                            }
                            else if (booking.Status == BookingStatus.Cancelled)
                            {
                                <span class="status-badge status-cancelled">‚ùå ƒê√É H·ª¶Y</span>
                            }
                        </div>
                        <span class="text-muted" style="font-size: 0.875rem;">
                            T·∫°o: @booking.CreatedDate.ToString("dd/MM/yyyy HH:mm")
                        </span>
                    </div>
                </div>

                <div style="padding: 1rem 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <div style="color: var(--color-gray-700); font-size: 0.875rem; margin-bottom: 0.25rem;">
                                S√¢n ƒê·∫•u
                            </div>
                            <div style="font-weight: 600; font-size: 1.125rem;">
                                üè∏ @(booking.Court?.Name ?? "Kh√¥ng x√°c ƒë·ªãnh")
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--color-gray-700); font-size: 0.875rem; margin-bottom: 0.25rem;">
                                Ng√†y ƒê·∫∑t
                            </div>
                            <div style="font-weight: 600; font-size: 1.125rem;">
                                üìÜ @booking.StartTime.ToString("dd/MM/yyyy")
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <div style="color: var(--color-gray-700); font-size: 0.875rem; margin-bottom: 0.25rem;">
                                Th·ªùi Gian B·∫Øt ƒê·∫ßu
                            </div>
                            <div style="font-weight: 600;">
                                üïê @booking.StartTime.ToString("HH:mm")
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--color-gray-700); font-size: 0.875rem; margin-bottom: 0.25rem;">
                                Th·ªùi Gian K·∫øt Th√∫c
                            </div>
                            <div style="font-weight: 600;">
                                üïê @booking.EndTime.ToString("HH:mm")
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(booking.Notes))
                    {
                        <div>
                            <div style="color: var(--color-gray-700); font-size: 0.875rem; margin-bottom: 0.25rem;">
                                Ghi Ch√∫
                            </div>
                            <div style="padding: 0.5rem; background-color: var(--color-gray-100); border-radius: 0.25rem; font-size: 0.875rem;">
                                üìù @booking.Notes
                            </div>
                        </div>
                    }
                </div>

                <div class="card-footer" style="justify-content: space-between;">
                    <div style="display: flex; gap: 0.5rem;">
                        @{
                            var duration = booking.EndTime - booking.StartTime;
                            var hours = (int)duration.TotalHours;
                            var minutes = duration.Minutes;
                            var durationStr = hours > 0 ? $"{hours}h {minutes}m" : $"{minutes}m";
                        }
                        <span class="status-badge" style="background-color: var(--color-blue-100); color: var(--color-blue-700);">
                            ‚è±Ô∏è @durationStr
                        </span>
                    </div>
                    @if (booking.Status == BookingStatus.Confirmed)
                    {
                        <a href="@Url.Page("Create")" class="btn btn-outline" style="font-size: 0.875rem;">
                            ‚ûï ƒê·∫∑t S√¢n Kh√°c
                        </a>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="card" style="text-align: center; padding: 3rem 1rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
        <p style="color: var(--color-gray-700); margin: 0;">
            B·∫°n ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t s√¢n n√†o
        </p>
        <a href="@Url.Page("Create")" class="btn btn-primary" style="margin-top: 1rem; display: inline-block;">
            ‚ûï ƒê·∫∑t S√¢n Ngay
        </a>
    </div>
}
